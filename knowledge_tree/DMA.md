# DMA 简略介绍

[百科](<https://baike.baidu.com/item/DMA%E6%96%B9%E5%BC%8F/8666476?fr=aladdin>)

>## 介绍 
>* DMA方式，Direct Memory Access，也称为成组数据传送方式，有时也称为直接内存操作。
>* DMA方式在数据传送过程中，没有保存现场、恢复现场之类的工作。
>* 由于CPU根本不参加传送操作，因此就省去了CPU取指令、取数、送数等操作。
>* 内存地址修改、传送字 个数的计数等等，也不是由软件实现，而是用硬件线路直接实现的。
>* 所以DMA方式能满足高速I/O设备的要求，也有利于CPU效率的发挥。
>* 原理一个设备接口试图通过总线直接向另一个设备发送数据(一般是大批量的数据)，
>* 它会先向CPU发送DMA请求信号。外设通过DMA的一种专门接口电路――DMA控制器（DMAC），
>* 向CPU提出接管总线控制权的总线请求，CPU收到该信号后，在当前的总线周期结束后，
>* 会按DMA信号的优先级和提出DMA请求的先后顺序响应DMA信号。CPU对某个设备接口响应DMA请求时，
>* 会让出总线控制权。于是在DMA控制器的管理下，外设和存储器直接进行数据交换，而不需CPU干预。
>* 数据传送完毕后，设备接口会向CPU发送DMA结束信号，交还总线控制权。

>## 基本操作
>* 实现DMA传送的基本操作如下：
>1. 外设可通过DMA控制器向CPU发出DMA请求；
>2. CPU响应DMA请求，系统转变为DMA工作方式，并把总线控制权交给DMA控制器；
>3. 由DMA控制器发送存储器地址，并决定传送数据块的长度；
>4. 执行DMA传送；
>5. DMA操作结束，并把总线控制权交还CPU。


>## 工作过程
>### 预处理阶段
>1. 测试设备状态；
>2. 向DMA控制器的设备地址寄存器中送入设备号，并启动设备；
>3. 向主存地址计数器中送入欲交换数据的主存起始地址；向字计数器中送入欲交换的数据个数。
>4. 外部设备准备好发送的数据（输入）或上次接收的数据已处理完毕（输出）时，将通知DMA控制器发出DMA请求，申请主存总线。
数据传送



>### 输入操作
> 1. 首先从外部设备读入一个字（设每字16位）到DMA数据缓冲寄存器IODR中（如果设备是面向字节的，一次读入一个字节，需要将两个字节装配成一个字）。
> 2. 外部设备发选通脉冲，使DMA控制器中的DMA请求标志触发器置“1”。
> 3. DMA控制器向CPU发出总线请求信号（HOLD）。
> 4. CPU在完成了现行机器周期后，即响应DMA请求，发出总线允许信号（HLDA），并由DMA控制器发出DMA响应信号，使DMA请求标记触发器复位。此时，由DMA控制器接管系统总线。
> 5. 将DMA控制器中主存地址寄存器中的主存地址送地址总线，
> 6. 将DMA数据缓冲寄存器中的内容送数据总线。
> 7. 在读/写控制信号线上发出写命令。
> 8. 将DMA地址寄存器的内容加1，从而得到下一个地址，字计数器减1。
> 9. 判断字计数器的值是否为“0”。若不为“0”，说明数据块没有传送完毕，返回⑤，传送下一个数据；若为“0”，说明数据块已经传送完毕，则向CPU申请中断处理。



>### 输出操作
>1. 当DMA数据缓冲寄存器已将输出数据送至I/O设备后，表示数据缓冲寄存器为“空”；
>2. 外部设备发选通脉冲，使DMA控制器中的DMA请求标志触发器置“1”；
>3. DMA控制器向CPU发出总线请求信号（HOLD）；
>4. CPU在完成了现行机器周期后，即响应DMA请求，发出总线允许信号（HLDA），并由DMA控制器发出DMA响应信号，使DMA请求标记触发器复位。此时，由DMA控制器接管系统总线；
>5. 将DMA控制器中主存地址寄存器中的主存地址送地址总线，在读/写控制信号线上发出读命令；
>6. 主存将相应地址单元的内容通过数据总线读入到DMA数据缓冲寄存器中；
>7. 将DMA数据缓冲寄存器的内容送到输出设备；
>8. 将DMA地址寄存器的内容加1，从而得到下一个地址，字计数器减1；
>9. 判断字计数器的值是否为“0”。若不为“0”，说明数据块没有传送完毕，返回到⑤，传送下一个数据；若为“0”，说明数据块已经传送完毕，则向CPU申请中断处理。


>### 传送后处理
>1. 校验送入主存的数据是否正确。
>2. 决定是否继续用DMA传送其他数据块。
>3. 测试在传送过程中是否发生错误。


